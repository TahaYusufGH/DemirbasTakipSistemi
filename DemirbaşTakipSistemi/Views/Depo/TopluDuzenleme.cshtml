@model DemirbaşTakipSistemi.Models.ViewModels.DepoTopluDuzenlemeViewModel
@using DemirbaşTakipSistemi.Models.Enums

@{
    ViewData["Title"] = "Depo Toplu Düzenleme";
}

<div class="container-fluid">
    <h2>Depo Toplu Düzenleme</h2>

    <div class="row mb-3">
        <div class="col">
            <div class="btn-group" role="group">
                <a asp-action="Index" class="btn btn-secondary">
                    <i class="fas fa-arrow-left"></i> Depo Listesine Dön
                </a>
            </div>
        </div>
    </div>

    <div class="card mb-4">
        <div class="card-header">
            <i class="fas fa-search me-1"></i>
            Demirbaş Arama
        </div>
        <div class="card-body">
            <form asp-action="TopluDuzenleme" method="get" class="mb-4">
                <div class="row mb-3">
                    <div class="col-md-3">
                        <div class="form-group">
                            <label asp-for="SeriNo" class="form-label"></label>
                            <input asp-for="SeriNo" class="form-control" />
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="form-group">
                            <label asp-for="Kategori" class="form-label"></label>
                            <select asp-for="Kategori" class="form-control">
                                <option value="">-- Tümü --</option>
                                @foreach (var kategori in Model.Kategoriler)
                                {
                                    <option value="@kategori">@kategori</option>
                                }
                            </select>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="form-group">
                            <label asp-for="DurumFiltresi" class="form-label">Durum</label>
                            <select asp-for="DurumFiltresi" class="form-control">
                                <option value="">-- Tümü --</option>
                                <option value="0">Aktif</option>
                                <option value="1">Zimmetli</option>
                                <option value="2">Arizali</option>
                                <option value="3">Bakimda</option>
                                <option value="4">Hurda</option>
                                <option value="5">Depoda</option>
                                <option value="6">Zimmette</option>
                                <option value="7">Iade</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="form-group">
                            <label asp-for="OdaIdFiltresi" class="form-label">Oda</label>
                            <select asp-for="OdaIdFiltresi" class="form-control select2">
                                <option value="">-- Tümü --</option>
                                @foreach (var oda in Model.Odalar)
                                {
                                    <option value="@oda.Id">@oda.OdaKodu - @oda.Ad</option>
                                }
                            </select>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col">
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-search"></i> Ara
                        </button>
                        <a asp-action="TopluDuzenleme" class="btn btn-secondary">
                            <i class="fas fa-redo"></i> Temizle
                        </a>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <form asp-action="TopluDuzenleme" method="post">
        <input type="hidden" asp-for="SeriNo" />
        <input type="hidden" asp-for="Kategori" />
        <input type="hidden" asp-for="DurumFiltresi" />
        <input type="hidden" asp-for="OdaIdFiltresi" />

        <div class="card mb-4">
            <div class="card-header">
                <i class="fas fa-list me-1"></i>
                Demirbaş Listesi
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-bordered table-striped" id="demirbasTable">
                        <thead>
                            <tr>
                                <th>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="selectAll">
                                        <label class="form-check-label" for="selectAll">Tümü</label>
                                    </div>
                                </th>
                                <th>Seri No</th>
                                <th>Demirbaş Kodu</th>
                                <th>Kategori</th>
                                <th>Alt Kategori</th>
                                <th>Durum</th>
                                <th>Oda</th>
                                <th>Açıklama</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var item in Model.Demirbaslar)
                            {
                                <tr>
                                    <td>
                                        <div class="form-check">
                                            <input class="form-check-input demirbas-checkbox" type="checkbox" name="SecilenDemirbasIds" value="@item.Id" id="demirbas_@item.Id">
                                        </div>
                                    </td>
                                    <td>@(item.SeriNo ?? "-")</td>
                                    <td>@item.DemirbasKodu</td>
                                    <td>@item.Kategori</td>
                                    <td>@(item.Model ?? "-")</td>
                                    <td>@item.Durum</td>
                                    <td>@(item.Oda?.Ad ?? "-")</td>
                                    <td>@(item.Aciklama ?? "-")</td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="card mb-4">
            <div class="card-header">
                <i class="fas fa-edit me-1"></i>
                Toplu Düzenleme
            </div>
            <div class="card-body">
                <div class="row mb-3">
                    <div class="col-md-4">
                        <div class="form-group">
                            <label asp-for="EnvanterTuru" class="form-label">Envanter Türü</label>
                            <input asp-for="EnvanterTuru" class="form-control" />
                            <small class="form-text text-muted">Boş bırakırsanız mevcut değer korunacaktır.</small>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-group">
                            <label asp-for="Birim" class="form-label"></label>
                            <select asp-for="Birim" class="form-control">
                                <option value="">-- Değiştirme --</option>
                                <option value="Adet">Adet</option>
                                <option value="Kutu">Kutu</option>
                                <option value="Paket">Paket</option>
                                <option value="Set">Set</option>
                                <option value="Takım">Takım</option>
                            </select>
                            <small class="form-text text-muted">Boş bırakırsanız mevcut değer korunacaktır.</small>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-group">
                            <label asp-for="OdaId" class="form-label">Oda Numarası</label>
                            <select asp-for="OdaId" class="form-control select2">
                                <option value="">-- Değiştirme --</option>
                                @foreach (var oda in Model.Odalar)
                                {
                                    <option value="@oda.Id">@oda.OdaKodu - @oda.Ad</option>
                                }
                            </select>
                            <small class="form-text text-muted">Boş bırakırsanız mevcut değer korunacaktır.</small>
                        </div>
                    </div>
                </div>

                <div class="row mb-3">
                    <div class="col-md-4">
                        <div class="form-group">
                            <label asp-for="Durum" class="form-label"></label>
                            <select asp-for="Durum" class="form-control">
                                <option value="">-- Değiştirme --</option>
                                <option value="0">Aktif</option>
                                <option value="1">Zimmetli</option>
                                <option value="2">Arizali</option>
                                <option value="3">Bakimda</option>
                                <option value="4">Hurda</option>
                                <option value="5">Depoda</option>
                                <option value="6">Zimmette</option>
                                <option value="7">Iade</option>
                            </select>
                            <small class="form-text text-muted">Boş bırakırsanız mevcut değer korunacaktır.</small>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-group">
                            <label asp-for="KontrolEdenId" class="form-label">Kontrol Eden</label>
                            <select asp-for="KontrolEdenId" class="form-control select2">
                                <option value="">-- Seçiniz --</option>
                                @foreach (var kullanici in Model.Kullanicilar)
                                {
                                    <option value="@kullanici.Id">@kullanici.Ad @kullanici.Soyad (@(kullanici.SicilNo ?? "Sicil No Yok"))</option>
                                }
                            </select>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-group">
                            <label asp-for="GuncellemeTarihi" class="form-label"></label>
                            <input asp-for="GuncellemeTarihi" class="form-control" type="date" />
                        </div>
                    </div>
                </div>

                <div class="form-group mb-3">
                    <label asp-for="Aciklama" class="form-label"></label>
                    <textarea asp-for="Aciklama" class="form-control" rows="3"></textarea>
                    <small class="form-text text-muted">Boş bırakırsanız mevcut değer korunacaktır.</small>
                </div>

                <div class="form-group">
                    <button type="submit" class="btn btn-primary" id="submitButton" disabled>
                        <i class="fas fa-save"></i> Seçilenleri Güncelle
                    </button>
                </div>
            </div>
        </div>
    </form>
</div>

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
    <script>
        $(document).ready(function () {
            $('.select2').select2({
                width: '100%'
            });

            $('#demirbasTable').DataTable({
                language: {
                    url: '//cdn.datatables.net/plug-ins/1.13.4/i18n/tr.json'
                }
            });

            // Tümünü seç/kaldır
            $('#selectAll').change(function () {
                $('.demirbas-checkbox').prop('checked', $(this).prop('checked'));
                updateSubmitButton();
            });

            // Checkbox değişikliklerini izle
            $('.demirbas-checkbox').change(function () {
                updateSubmitButton();
            });

            // Güncelle butonunu etkinleştir/devre dışı bırak
            function updateSubmitButton() {
                var anyChecked = $('.demirbas-checkbox:checked').length > 0;
                $('#submitButton').prop('disabled', !anyChecked);
            }
        });
    </script>
}